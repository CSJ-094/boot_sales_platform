<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.OrdDAO">

    <!-- 회원 ID로 주문 목록 조회 -->
    <select id="getOrdersByMemberId" resultType="com.boot.dto.OrdDTO">
        SELECT
            ORD_ID as ordId,
            ORD_MEMID as ordMemId,
            ORD_DATE as ordDate,
            ORD_AMOUNT as ordAmount,
            ORD_DFEE as ordDfee,
            ORD_DISCOUNT as ordDiscount,
            ORD_STATUS as ordStatus
        FROM ORDER_DB
        WHERE ORD_MEMID = #{memberId}
        ORDER BY ORD_DATE DESC
    </select>

    <!-- 새로운 주문 정보 저장 -->
    <insert id="save" parameterType="com.boot.dto.OrdDTO">
        INSERT INTO ORDER_DB (ORD_ID, ORD_MEMID, ORD_DATE, ORD_AMOUNT, ORD_DFEE, ORD_DISCOUNT, ORD_STATUS)
        VALUES (#{ordId}, #{ordMemId}, SYSDATE, #{ordAmount}, #{ordDfee}, #{ordDiscount}, #{ordStatus})
    </insert>

    <!-- 주문 ID로 단일 주문 정보 조회 -->
    <select id="getOrderByOrderId" resultType="com.boot.dto.OrdDTO">
        SELECT
            ORD_ID as ordId,
            ORD_MEMID as ordMemId,
            ORD_DATE as ordDate,
            ORD_AMOUNT as ordAmount,
            ORD_DFEE as ordDfee,
            ORD_DISCOUNT as ordDiscount,
            ORD_STATUS as ordStatus
        FROM ORDER_DB
        WHERE ORD_ID = #{orderId}
    </select>

    <!-- 결제 완료 후 주문 상태 및 결제 키 업데이트 -->
    <update id="updateAfterPayment">
        UPDATE ORDER_DB
        SET ORD_STATUS = #{status},
            ORD_PAYMENT_KEY = #{paymentKey}
        WHERE ORD_ID = #{orderId}
    </update>
  
</mapper>
